#!/bin/bash

# Consul heartbeat script
# re-registers this node and sets it healthy in the non-HA Consul bootstrap service

while true
do
    consul info &> /dev/null
    if [ $? -eq 0 ]
    then

        # these executables get written by the triton-bootstrap script
        bash /bin/consul-register-cmd
        bash /bin/consul-health-cmd
    fi

    sleep $(( 10 + $RANDOM % 10 )) #sleep for 10-20 seconds
done
